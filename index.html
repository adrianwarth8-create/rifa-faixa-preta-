<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rifa Faixa Preta - Adrian Silva Warth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0b1c2d;
    color: white;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color: #e63946; }
  h2 { color: #1d9bf0; }
  .box {
    background: #14213d;
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
    margin: auto;
  }
  input, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 6px;
    border: none;
    font-size: 16px;
  }
  button {
    background: #e63946;
    color: white;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  button:hover {
    background: #ff4d5a;
  }
  .numeros {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
    gap: 6px;
    margin-top: 15px;
    max-height: 400px;
    overflow-y: auto;
  }
  .numero {
    background: #1d3557;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .numero.selecionado {
    background: #2ecc71;
    color: black;
  }
  .numero.ocupado {
    background: #e63946;
    color: white;
    cursor: not-allowed;
  }
  .contador {
    font-size: 20px;
    margin: 15px 0;
  }
  footer {
    margin-top: 20px;
    font-size: 14px;
    opacity: 0.8;
  }
</style>
</head>
<body>

<h1>RIFA ‚Äì FAIXA PRETA ü•ã</h1>
<h2>Adrian Silva Warth</h2>

<div class="contador" id="contador"></div>

<div class="box">
  <p><strong>üéØ Objetivo:</strong> Arrecadar R$ 4.000 para troca de faixa preta</p>
  <p><strong>üí∞ Valor:</strong> R$ 5,00 por n√∫mero</p>
  <p><strong>üèÜ Pr√™mios:</strong><br>
    ü•á 1¬∫ Ovelha carneada<br>
    ü•à 2¬∫ Cesta Cacau Show
  </p>
  <p><strong>üìÖ Sorteio:</strong> 25 de agosto √†s 10h (Instagram)</p>
  <p><strong>üìß Pix:</strong> adrianwarth8@gmail.com</p>

  <hr>

  <h3>Escolha seus n√∫meros</h3>
  <div class="numeros" id="numeros"></div>

  <input type="text" id="nome" placeholder="Seu nome completo">
  <input type="text" id="whats" placeholder="WhatsApp com DDD">
  <button onclick="reservar()">Reservar n√∫meros</button>
</div>

<footer>
  Ap√≥s o Pix, os n√∫meros ser√£o confirmados.<br>
  Contato: WhatsApp 55999929198
</footer>

<!-- Bibliotecas para PDF e QR Code -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxyN0airWnZSYmIN4ajtxO93u_sqZKU5BU6mmDM5GK4A9aegBtNiSejA3_iOI-_bT6PUg/exec";

let selecionados = []; // m√∫ltiplos n√∫meros selecionados
let numerosComprados = [];

// Carrega n√∫meros j√° comprados do Google Sheets
async function carregarNumerosComprados() {
  try {
    const res = await fetch(SCRIPT_URL);
    numerosComprados = await res.json();
    numerosComprados = [...new Set(numerosComprados)];
  } catch (e) {
    console.error("Erro ao carregar n√∫meros comprados:", e);
  }
}

// Gera 1000 n√∫meros
function gerarNumeros() {
  const numerosDiv = document.getElementById("numeros");
  for (let i = 1; i <= 1000; i++) {
    const n = document.createElement("div");
    n.className = "numero";
    n.innerText = i.toString().padStart(4, "0");

    if (numerosComprados.includes(i)) {
      n.classList.add("ocupado");
    } else {
      n.onclick = () => selecionarNumero(n);
    }

    numerosDiv.appendChild(n);
  }
}

// Sele√ß√£o m√∫ltipla
function selecionarNumero(el) {
  const numero = parseInt(el.innerText, 10);
  if (el.classList.contains("selecionado")) {
    el.classList.remove("selecionado");
    selecionados = selecionados.filter(n => n !== numero);
  } else {
    el.classList.add("selecionado");
    selecionados.push(numero);
  }
}

// Reserva m√∫ltiplos n√∫meros
async function reservar() {
  const nome = document.getElementById("nome").value.trim();
  const whats = document.getElementById("whats").value.trim();

  if (selecionados.length === 0 || !nome || !whats) {
    alert("Preencha todos os campos e escolha pelo menos um n√∫mero.");
    return;
  }

  // verifica se algum n√∫mero j√° est√° reservado
  for (let n of selecionados) {
    if (numerosComprados.includes(n)) {
      alert(`O n√∫mero ${n} j√° est√° reservado. Remova da sele√ß√£o.`);
      return;
    }
  }

  try {
    for (let n of selecionados) {
      const data = new URLSearchParams();
      data.append("nome", nome);
      data.append("whats", whats);
      data.append("numero", n);

      await fetch(SCRIPT_URL, { method: "POST", body: data });

      // atualiza visual
      const el = [...document.querySelectorAll(".numero")].find(x => parseInt(x.innerText,10) === n);
      if (el) el.classList.add("ocupado");
      numerosComprados.push(n);
    }

    // envia WhatsApp
    window.open(`https://wa.me/55${whats.replace(/\D/g,'')}?text=Ol√°! Reservei os n√∫meros ${selecionados.join(", ")} na rifa da faixa preta. J√° vou enviar o Pix.`);

    alert("N√∫meros reservados com sucesso! Envie o Pix para confirmar.");

    // gera recibo PDF
    gerarReciboPDF(nome, whats, selecionados);

    selecionados = []; // limpa sele√ß√£o
  } catch (e) {
    alert("Erro ao enviar. Tente novamente.");
  }
}

// Contador regressivo
const alvo = new Date("2026-08-25T10:00:00").getTime();
setInterval(() => {
  const agora = new Date().getTime();
  const diff = alvo - agora;
  const contador = document.getElementById("contador");

  if (diff < 0) {
    contador.innerText = "‚è∞ Sorteio hoje!";
    return;
  }

  const d = Math.floor(diff / (1000*60*60*24));
  const h = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
  const m = Math.floor((diff%(1000*60*60))/(1000*60));
  const s = Math.floor((diff%(1000*60))/1000);
  contador.innerText = `‚è≥ ${d}d ${h}h ${m}m ${s}s`;
}, 1000);

// Inicializa√ß√£o
(async () => {
  await carregarNumerosComprados();
  gerarNumeros();
})();

// Fun√ß√£o para gerar recibo PDF profissional
async function gerarReciboPDF(nome, whats, numeros) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const data = new Date().toLocaleString("pt-BR");
  const valorTotal = numeros.length * 5;

  // T√≠tulo
  doc.setFontSize(22);
  doc.setTextColor(230, 57, 70);
  doc.text("Recibo da Rifa ‚Äì Faixa Preta ü•ã", 105, 20, { align: "center" });

  // Subt√≠tulo
  doc.setFontSize(16);
  doc.setTextColor(29, 155, 240);
  doc.text("Adrian Silva Warth", 105, 30, { align: "center" });

  doc.setFontSize(12);
  doc.setTextColor(0,0,0);
  doc.text(`Data: ${data}`, 20, 50);
  doc.text(`Nome: ${nome}`, 20, 58);
  doc.text(`WhatsApp: ${whats}`, 20, 66);

  // N√∫meros reservados
  doc.text("N√∫meros Reservados:", 20, 78);
  let y = 86;
  numeros.forEach((n, i) => {
    doc.text(`${n.toString().padStart(4,'0')}`, 30 + (i%10)*18, y);
    if ((i+1)%10 === 0) y += 10;
  });

  // Valor total
  doc.setFontSize(14);
  doc.setFont("helvetica", "bold");
  doc.text(`Valor Total: R$ ${valorTotal},00`, 20, y + 15);

  // Mensagem de agradecimento personalizada
  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");
  doc.text("Obrigado por ajudar a tornar poss√≠vel a conquista da faixa preta! ü•ã", 105, y + 30, { align: "center" });
  doc.text("Seu apoio faz toda a diferen√ßa! üéâ", 105, y + 38, { align: "center" });

  // QR Code para Pix
  const qrDiv = document.createElement("div");
  new QRCode(qrDiv, {
    text: "PIX: adrianwarth8@gmail.com",
    width: 100,
    height: 100
  });
  const canvas = qrDiv.querySelector("canvas");
  const imgData = canvas.toDataURL("image/png");
  doc.addImage(imgData, 'PNG', 150, y, 40, 40);

  // Baixar PDF
  doc.save(`Recibo_Rifa_${nome.replace(/\s+/g,'_')}.pdf`);
}
</script>

</body>
</html>
